(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["32dc258b"],{"16f1":function(t,e,i){},"808f":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-avatar",{attrs:{size:t.size}},[i("q-img",{staticClass:"full-height",attrs:{src:t.avatarUrl+t.userId,"spinner-color":"accent"},scopedSlots:t._u([{key:"error",fn:function(){return[i("div",{staticClass:"absolute-full text-white flex justify-center",staticStyle:{padding:"0"}},[i("q-icon",{staticClass:"full-height",style:"font-size: "+t.size,attrs:{name:"account_circle"}})],1)]},proxy:!0}])})],1)},s=[],n=(i("c5f6"),{props:{userId:Number,size:{type:String,default:"60px"}},data:function(){return{avatarUrl:"".concat("https://intouristing-api.herokuapp.com/","users/avatar/")}}}),o=n,r=i("2877"),c=Object(r["a"])(o,a,s,!1,null,null,null);e["a"]=c.exports},9017:function(t,e,i){"use strict";var a=i("16f1"),s=i.n(a);s.a},a9c3:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-layout",{staticClass:"shadow-2 rounded-borders",attrs:{view:"hHh Lpr lff"}},[i("q-header",{staticClass:"dark-purple",attrs:{elevated:""}},[i("q-toolbar",[t.showBackButton?i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"mdi-arrow-left"},on:{click:t.onBack}}):i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"menu"},on:{click:function(e){t.drawer=!t.drawer}}}),t.titleParams?i("q-toolbar-title",[i("user-avatar",{attrs:{size:"40px","user-id":t.titleParams.avatar}}),t._v("\n        "+t._s(t.titleParams.title)+"\n      ")],1):i("q-toolbar-title"),i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"mdi-bell"},on:{click:t.fetchNotificationList}},[i("q-badge",{directives:[{name:"show",rawName:"v-show",value:t.notificationCount>0,expression:"notificationCount > 0"}],attrs:{floating:"",color:"red",label:t.notificationCount}}),i("q-menu",{attrs:{anchor:"bottom right"}},t._l(t.notificationList,function(e){return i("div",{key:e.id,staticClass:"row no-wrap q-pa-md"},[i("div",{staticClass:"col-9"},[i("div",{staticClass:"text-subtitle2 notification-user-name"},[t._v("\n                "+t._s(e.sender.name+" "+e.sender.lastName)+"\n              ")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-primary text-white q-mt-sm",attrs:{rounded:"",size:"sm",label:t.$t("profile")},on:{click:function(i){return t.showProfile(e)}}})],1),i("q-separator",{staticClass:"q-mx-xs",attrs:{vertical:"",inset:""}}),i("div",{staticClass:"col-2 items-right q-ml-xs"},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{round:"",color:"positive",icon:"mdi-check",size:"xs"},on:{click:function(i){return t.acceptRequest(e.id)}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mt-md",attrs:{round:"",color:"negative",icon:"mdi-close",size:"xs"},on:{click:function(i){return t.declineRequest(e.id)}}})],1)],1)}),0)],1)],1)],1),i("q-drawer",{attrs:{"show-if-above":"",mini:t.miniState,width:200,breakpoint:500,bordered:"","content-class":"bg-white"},on:{mouseover:function(e){t.miniState=!1},mouseout:function(e){t.miniState=!0}},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[i("q-scroll-area",{staticClass:"fit"},[i("q-list",{attrs:{padding:""}},[i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",to:"/search"}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-map-marker-radius"}})],1),i("q-item-section",[t._v("\n            "+t._s(t.$t("search"))+"\n          ")])],1),i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",to:"/chat"}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-comment-text"}})],1),i("q-item-section",[t._v("\n            Chat\n          ")])],1),i("q-separator"),i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",to:"/edit-profile"}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"account_circle"}})],1),i("q-item-section",[t._v("\n            "+t._s(t.name)+" "+t._s(t.lastName)+"\n          ")])],1),i("q-separator"),i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",to:"#"},on:{click:t.logout}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"logout"}})],1),i("q-item-section",[t._v("\n            "+t._s(t.$t("logout"))+"\n          ")])],1)],1)],1)],1),i("q-page-container",{staticClass:"bg-deep-purple-1"},[i("router-view")],1),i("user-profile-card",{ref:"profileCard",attrs:{"is-request":!0,notification:t.currNotification?t.currNotification.id:void 0,user:t.currNotification?t.currNotification.sender:void 0},on:{acceptRequest:t.acceptRequest,declineRequest:t.declineRequest}})],1)},s=[],n=(i("7f7f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-dialog",{model:{value:t.card,callback:function(e){t.card=e},expression:"card"}},[i("q-card",{staticStyle:{width:"300px","max-width":"350px"}},[i("q-img",{ref:"avatarImg",staticStyle:{height:"200px"},attrs:{src:t.avatarUrl+t.user.id,"spinner-color":"accent"},scopedSlots:t._u([{key:"error",fn:function(){return[i("div",{staticClass:"absolute-full text-white flex justify-center",staticStyle:{padding:"0"}},[i("q-icon",{staticStyle:{"font-size":"200px"},attrs:{name:"account_circle"}})],1)]},proxy:!0}])}),i("q-card-section",[i("q-btn",{staticClass:"absolute no-pointer-events cursor-none",staticStyle:{top:"0",right:"12px",transform:"translateY(-50%)"},attrs:{fab:"",color:"primary",icon:"place"}}),i("div",{staticClass:"row no-wrap items-center"},[i("div",{staticClass:"col text-h6 ellipsis"},[t._v(t._s(t.user.name)+"Â "+t._s(t.user.lastName))]),i("div",{staticClass:"col-auto text-grey q-pt-md"},[i("q-icon",{attrs:{name:"place"}}),t._v(" "+t._s(t.$toDistance(t.user.distance))+"\n        ")],1)])],1),i("q-separator"),t.isRequest?i("q-card-actions",{staticClass:"no-wrap"},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"fit",attrs:{flat:"",color:"negative"},on:{click:t.declineRequest}},[t._v("\n        "+t._s(t.$t("decline"))+"\n      ")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"fit",attrs:{flat:"",color:"positive"},on:{click:t.acceptRequest}},[t._v("\n        "+t._s(t.$t("accept"))+"\n      ")])],1):t._e()],1)],1)}),o=[],r=(i("c5f6"),{props:{user:{type:Object,default:function(){return{}}},isRequest:Boolean,notification:Number},data:function(){return{card:!1,avatarUrl:"".concat("https://intouristing-api.herokuapp.com/","users/avatar/")}},methods:{openCard:function(){this.$forceUpdate(),this.card=!0},acceptRequest:function(){this.$emit("acceptRequest",this.notification)},declineRequest:function(){this.$emit("declineRequest",this.notification)}}}),c=r,u=i("2877"),l=Object(u["a"])(c,n,o,!1,null,null,null),d=l.exports,p=i("808f"),f={components:{UserProfileCard:d,UserAvatar:p["a"]},created:function(){var t=this;this.$root.$on("addBackButton",function(e){t.showBackButton=!0,t.backButtonCallback=e}),this.$root.$on("addTitle",function(e){t.titleParams=e});var e=this.$getStompHeaders();e.id="".concat(this.user.username,"-search");var i=function(){t.notificationCount="number"===typeof t.notificationCount?t.notificationCount+1:1,t.$infoAlert(t.$t("thereAreNewNotifications"),{position:"bottom-right"})},a=function(){t.$store.dispatch("stomp/subscribe",{name:"request",destination:"/user/queue/request",callback:i,headers:e})};this.$store.dispatch("stomp/connect",a);var s={enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0};if("geolocation"in navigator){var n=function(i){if(!t.isUpdated){setTimeout(function(){t.isUpdated=!1},3e3);var a={user:t.userId,latitude:i.coords.latitude,longitude:i.coords.longitude};e.id="".concat(t.user.username,"-update-position"),t.$store.dispatch("stomp/send",{destination:"/ws/update-position",body:a,headers:e}),t.isUpdated=!0}},o=function e(){t.watchId=navigator.geolocation.watchPosition(n,function(t){console.error(t),e()},s)};o()}},data:function(){return this.fetchNotificationList(),{drawer:!1,miniState:!0,user:{id:this.$store.getters["auth/getAccount"].id,username:this.$store.getters["auth/getAccount"].username},notificationCount:0,notificationList:this.fetchNotifications,currNotification:Object,isUpdated:!1,watchId:null,showBackButton:!1,backButtonCallback:null,titleParams:null}},computed:{name:function(){return this.$store.getters["auth/getAccount"].name||""},lastName:function(){return this.$store.getters["auth/getAccount"].lastName||""}},methods:{logout:function(){navigator.geolocation.clearWatch(this.watchId),this.$store.dispatch("auth/logout"),this.$router.push("/login")},fetchNotificationList:function(){var t=this;this.$axios.get("requests/count").then(function(e){t.notificationCount=e.data||0}),this.$axios.get("requests").then(function(e){t.notificationList=e.data})},showProfile:function(t){this.currNotification=t,this.$refs.profileCard.openCard()},acceptRequest:function(t){this.answerRequest("accept-request",t)},declineRequest:function(t){this.answerRequest("decline-request",t)},answerRequest:function(t,e){var i=this.$getStompHeaders();i.id="".concat(this.user.username,"-").concat(t),this.$store.dispatch("stomp/send",{destination:"/ws/".concat(t),body:e,headers:i}),this.notificationCount-=1},onBack:function(){"function"===typeof this.backButtonCallback&&this.backButtonCallback(),this.titleParams&&this.titleParams.clearOnBack&&(this.titleParams=null),this.showBackButton=!1}}},m=f,h=(i("9017"),Object(u["a"])(m,a,s,!1,null,"bbbecb76",null));e["default"]=h.exports}}]);